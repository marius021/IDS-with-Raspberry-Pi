{
  "version": "2.0.0",
  "tasks": [
    {
      "type": "docker-build",
      "label": "docker-build",
      "platform": "python",
      "dockerBuild": {
        "tag": "ids-pipeline:latest",
        "dockerfile": "${workspaceFolder}/Dockerfile",
        "context": "${workspaceFolder}",
        "pull": true
      }
    },
    {
      "type": "docker-run",
      "label": "docker-run: train",
      "dependsOn": ["docker-build"],
      "python": { "file": "csv-preprocessing.py" },
      "dockerRun": {
        "volumes": [
          { "localPath": "${workspaceFolder}", "containerPath": "/app" },
          { "localPath": "${workspaceFolder}/data", "containerPath": "/app/data" },
          { "localPath": "${workspaceFolder}/artifacts", "containerPath": "/app/artifacts" }
        ]
      }
    },
    {
      "type": "docker-run",
      "label": "docker-run: infer",
      "dependsOn": ["docker-build"],
      "python": {
        "file": "ids_inference.py",
        "args": [
          "--input", "/app/data/sample.csv",
          "--model", "/app/artifacts/ids_mlp_binary.onnx",
          "--scaler", "/app/artifacts/scaler.joblib",
          "--features", "/app/artifacts/feature_names.npy",
          "--mode", "binary",
          "--out", "/app/artifacts/preds.csv"
        ]
      },
      "dockerRun": {
        "volumes": [
          { "localPath": "${workspaceFolder}", "containerPath": "/app" },
          { "localPath": "${workspaceFolder}/data", "containerPath": "/app/data" },
          { "localPath": "${workspaceFolder}/artifacts", "containerPath": "/app/artifacts" }
        ]
      }
    }
  ]
}
